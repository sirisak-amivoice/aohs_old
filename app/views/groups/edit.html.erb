<% content_for :header do %>
  <script type="text/javascript">    
    $(document).ready(function(){
       <% @group_categorize.each do |gc|%>
                select_by_value("select[name=cate[]]","<%=gc.group_category_id%>");
           <%end%>
      });
     function select_by_value(path, value)
    {
        $(path + " option[value=" + value + "]").attr("selected","selected");
    }
  </script>

  <script type="text/javascript">
      function del_group(id,name){
          $("#delDialog").text("");
          $("#delDialog").append("Are you sure to delete group \"<b>" + name + "</b>\"");
          $("#delDialog").dialog("open");
          $("#delDialog").dialog({
            bgiframe: true,
            title: "Deleting group...",
            modal: true,
            buttons:{
              "Cancel": function(){ $(this).dialog("close"); },
              "Ok": function(){ window.location = "<%= url_for(:controller => 'groups',:action => 'delete') %>/" + id ; }
            }
          });
      }
  </script>
  
<% end %>

<% content_for :submenu do %>
  <div id="submenu">
    <table width="100%">
      <tr>
        <td align="left">
          <ul>
            <li><%= link_image_tag('Back','back.png',{:controller => "groups",:action=>"index"},{:title => 'Back to group list'}) %></li>
            <li><%= link_image_tag('Show detail','detail.png',{:controller => "groups",:action=>"show", :id => @group.id},{:title => 'Show group detail'}) %></li>
            <li><%= link_image_tag('Delete group','delete.png','#',{:onclick => "del_group(#{@group.id},\"#{@group.name}\")",:title => 'Delete group'}) %></li>
          </ul>
        </td>
        <td align="right">

        </td>
      </tr>
    </table>
  </div>
<% end %>

<div  class="div-form-default-style1">
  <table class="tblfrm" width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td><span class="span-form-name">Group infomation</span></td>
    </tr>
    <tr>
      <td >
        <% form_for @group,:url => {:controller => "groups",:action=>"update",:id=>@group.id} do |f| %>
          <%=display_frm_error(flash[:message]) %>    
          <table class="tbl-frm-details" cellpadding="0" cellspacing="0">
            <tr>
              <td width="140px" valign="top"><label>Group's name:</label></td>
              <td><%= f.text_field :name %><span class="span-require">*</span>
              <br><span class="note">Group name must have a minimum of 4 characters</span></td>
            </tr>
            <tr>
              <td><label>Description:</label></td>
              <td><%= f.text_field :description %></td>
            </tr>
            <tr>
              <td><label>Leader:</label></td>
              <td><%= f.collection_select "leader_id",Manager.find(:all,:conditions=>"role_id <> 0",:order => 'display_name'), :id, :display_name,{:include_blank => 'None'} %></td>
            </tr>
            <tr>
              <td><label>Categories list:</label><span class="span-require">*</span></td>
              <td></td>
            </tr>
            <% categories = {} %>
            <% @group.categories.to_ary.map{|c| categories[c.category_type.name] = c.value } %>
            <% if_first = true %>            
            <% @group_category_types.each do |gct| %>
            <tr>
              <td><label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <%= gct.name %>:</label></td>
              <td><%= f.select('id',GroupCategory.find(:all, :conditions=>{:group_category_type_id => gct.id }).collect { |x| [x.value,x.id] },{:include_blank => 'None',:selected=>"None"},{:name => "cate[]"}) %><% if if_first %><span class="span-require">*</span><% end %></td></tr>
            <% if_first = false %>    
            <% end %>
            <tr>
              <td></td>
              <td><span class="note">Please choose category at least one category.</span></td>
            </tr>            
            <tr>
              <td></td>
              <td><%= submit_tag " Update group ",{:class => 'btnAccept'} %></td>
            </tr>
            </table>
        <% end %>
      </td>
    </tr>
  </table>
</div>
