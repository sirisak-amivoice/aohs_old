<% content_for :header do %>

  <script type="text/javascript">
    $(document).ready(function(){

      $("#display_tree").focus(function(){
        var list = document.getElementById("display_tree");
          var theList = "";
          // start with a "?" to make it look like a real query-string
          for (i = 0; i <= list.options.length-1; i++) {
            theList += (i+1).toString() + "=" + list.options[i].text;
            //theList += list.options[i].value + "=" + list.options[i].text;
            // a "&" only BETWEEN the items, so not at the end
            if (i != list.options.length-1) theList += ",";
          }
          $("#cate_type").val(theList);
          //$("#values").val(theList);
      });

    });

    function move(index,to) {
      var list = document.getElementById("display_tree");
      var total = list.options.length-1;

      if (index == -1) return false;
      if (to == +1 && index == total) return false;
      if (to == -1 && index == 0) return false;

      var items = new Array;
      var values = new Array;

      for (i = total; i >= 0; i--) {
        items[i] = list.options[i].text;
        values[i] = list.options[i].value;
      }

      for (i = total; i >= 0; i--) {
        if (index == i) {
          list.options[i + to] = new Option(items[i],values[i + to], 0, 1);
          list.options[i] = new Option(items[i + to], values[i]);
          i--;
        }
        else {
          list.options[i] = new Option(items[i], values[i]);
        }
      }

      list.focus();
     }
      function btnreset(){
          $("#resetDialog").dialog("destroy");
          $("#resetDialog").text("");
          $("#resetDialog").append("Are you sure to reset?");
          $("#resetDialog").dialog("open");
          $("#resetDialog").dialog({
            bgiframe: true,
            title: "Confirmation ...",
            modal: true,
            buttons:{
              "Cancel": function(){ $(this).dialog("close"); },
              "Ok": function(){
                  $(this).dialog("close");
                  $.get("<%=url_for(:controller => 'group_category', :action => 'reset_display_tree')%>",function(){
                    window.location.reload();
                  }); }
            }
          });
     }

  </script>
  <style>
    #display_tree, .selection {
      font-size:16px;
      width:250px;
      color:blue;
      height:150px;
    }
    #click-up {
      width:70px;
      margin-left:10px;
    }
    #click-down {
      width:70px;
      margin-left:10px;  
    }
    #click-reset {
      width:70px;
      margin-left:10px;
      margin-top:5px;  
    }
  </style>
<% end %>
 <div id="resetDialog" style="display:none"></div>
<% content_for :submenu do %>
  <div id="submenu">
    <table width="100%">
      <tr>
        <td align="left">
          <ul>
            <li><%= link_image_tag('Back','back.png',{:controller=>"group_categories", :action=>"index"}) %></li>
            <li><%= link_image_tag('New category\'s type','new.png',{:controller=>"group_category_types", :action=>"new"}) %></li>
          </ul>
        </td>
        <td align="right">

        </td>
      </tr>
    </table>
  </div>
<% end %>

<div id="div-block-tree">
    <div class="div-form-default-style1">
  <table class="tblfrm" width="100%" cellpadding="0" cellspacing="0">
    <tr>
        <td><span class="span-form-title">Categories List</span></td>
    </tr>
    <tr>
        <td><span class="span-form-name">Categories List</span></td>
    </tr>
    <tr>
      <td>
        <% form_tag :controller => 'group_category',:action => 'update_display_tree' do %>
        <table class="tbl-frm-details">
          <tr>
            <td colspan="2"><span class="span-field-description">Use order button to order categories list for display in agents tree.</span></td>
          </tr>
          <tr>
            <td>
              <%= select_tag('display_tree',@cate_type,{:multiple => true, :id => 'display_tree',:class => 'selection',:name => 'list'}) %>
              <%= hidden_field_tag "cate_type" %>
            </td>
            <td align="center">
              <input type="button" value="Up" id="click-up" onClick="move(this.form.list.selectedIndex,-1)"><br>
              <input type="button" value="Down" id="click-down" onClick="move(this.form.list.selectedIndex,+1)"><br>
              <input type="button" value="Reset" id="click-reset" onClick="btnreset()">
            </td>
          </tr>
          <tr>
            <td colspan="2"><%= submit_tag('Save change',{:class => 'btnAccept'}) %></td>
          </tr>
        </table>
        <% end %>
      </td>
    </tr>
  </table>
</div> </div>
