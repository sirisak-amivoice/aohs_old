#!/bin/bash

#script/generate scaffold voice_log system_id:integer device_id:integer channel_id:integer ani:string dnis:string extension:string start_time:time duration:integer hangup_cause:integer call_reference:integer agent_id:string disposition:string customer_id:string

#script/generate model result_keyword voice_log_id:integer start_msec:integer end_msec:integer keyword:string

# master
script/generate scaffold user name:string group_id:integer permission_id:integer lock_version:integer
script/generate scaffold group name:string description:string parent_id:integer lft:integer rgt:integer lock_version:integer
script/generate model role name:string description:string lock_version:integer
script/generate model privilege name:string description:string lock_version:integer
script/generate model permission role_id:integer privilege_id:integer lock_version:integer
script/generate controller permission index

# log & events
script/generate model event name:string description:string sevelity:integer
script/generate controller event index
script/generate model log name:string description:string user:string
script/generate controller log index

# configuration & modules
script/generate scaffold configuration variable:string value:string value_type:string default_value:string description:string parent_id:integer lft:integer rgt:integer lock_version:integer
script/generate model client_module version:string
script/generate model module_file filename:string version:string filetype:string client_module_id:integer
script/generate controller client_module index show upload

# ナビゲーションページ
script/generate controller top_panel index
script/generate controller control_panel index

# group再考
# ユーザは必ずひとつのグループに所属する
# グループは業務を持っている
# グループは同じ場所に配置されている
# グループにはグループリーダーがいる
# グループがいろいろな属性を持っていて、それを集約する役目がある。ユーザ毎に設定するのではなく。
#
# ■場所
#  Bangkok
#   19F
#   20F
#  Khonkean
#  Chanmai
#  Hatyai
#
# ■業務
#  Current1
#  Delinquent1
#  Delinquent2
#
# ■グループ
#  グループ名  業務名    場所      場所2   リーダー
#  Team500     Current1  Bangkok   19F     Reader500
#  Team510     Current1  Bangkok   19F     Reader510
#  Team520     Current1  Bangkok   19F     Reader520
#  Team530     Current1  Bangkok   19F     Reader530
#  Team540     Current1  Bangkok   19F     Reader540
#  Team550     Current2  Bangkok   18F     Reader550
#  Team560     Current2  Bangkok   18F     Reader560
#  Team570     Current2  Bangkok   18F     Reader570
#  Team580     Current2  Bangkok   18F     Reader580
#  Team590     Current2  Bangkok   18F     Reader590
#  Team660     Current1  Khonkean  null    Reader660
#  Team670     Current2  Khonkean  null    Reader670
#
# 案１
script/generate scaffold location name:string description:string parent_id:integer lft:integer rgt:integer lock_version:integer
script/generate scaffold task name:string description:string parent_id:integer lft:integer rgt:integer lock_version:integer
script/generate scaffold group name:string descriptin:string
# 案２
# タグをグループ化する。グループは階層構造を持てる。→　ようにすれば表現力が増える。
# ただし、付与したタグを階層構造上に分類して表示するために
# 階層構造を定義する必要がある → orderを保持できるtree
script/generate scaffold group name:string leader:user_id descriptin:string
script/generate model group_category group_category_type_id:integer value:string
script/generate model group_category_type name:string
script/generate model group_categorization group_id:integer group_attribute_id:integer
script/generate model group_category_display_tree group_category_type:string parent_id:integer lft:integer rgt:integer
# 例
1  Team510  Yamamoto
2  Team520  Kaneko
3  Team530  Ratirat

1  Task       Current
2  Task       Delinquent1
3  Task       Delinquent2
4  Location   Modernform 19F
5  Location   Modernform 18F
6  Site       Bangkok
7  Site       North
8  Site       North East
9  Site       South

1  1  1
2  1  4
3  1  6
4  2  2
5  2  5
6  2  6
7  3  3
8  3  5
9  3  6

Bangkok
 Modernform 19F
  Team510 <Yamamoto>
 Modernform 18F
  Team520 <Kaneko>
  Team530 <Ratirat>

Bangkok
 Current
  Team510 <Yamamoto>
 Delinquent1
  Team520 <Kaneko>
 Delinquent2
  Team530 <Ratirat>

Site
 Location

Site
  Task


#
# Dash board
#
script/generate controller dash_board monitor
script/generate controller statistics index

#
# ユーザとエージェントをわける
# Userクラスは認証等を受け持つのでそれぞれをUserから派生させる
#  Agent < User
#  Manager < User
# 手順メモ
#  1. Userにtype:stringを追加
#  2. Userの代わりにAgent、ManagerをそれぞれnewしてsaveするとUser.typeにAgent or Managerが保存される
#     得にDBについては意識する必要なし。AgentとManagerを使えばよい。
# 追記
#  agents/index, show, edit, newなどのURLに対応する必要あり。
#  3. db/configに以下を追加してすべてUserControllerで処理する
#   map.connect 'agents/:action/:id', :controller => 'users', :type => 'Agent'
#   map.connect 'managers/:action/:id', :controller => 'users', :type => 'Manager'
#

#
# キーワードは集計と編集を統合する
#  - 集計は夜中のバッチで行う.
#  - キーワード名が変更されたら関連をきる
#  - 新規キーワードはもちろん過去のデータなし
script/generate scaffold keyword name:string match_string:string type:string

# 集計
# - キーワードはタグごとに集計できるようにしたい
# - 通話数についても集計できるようにしたい）
# 日、週、月ごとに汎用的に集計できるテーブルを準備
# 夜中のバッチ処理にて更新する
script/generate model statistics_type name:string type:string value_type:string
script/generate model statistics_daily_statistics day:date statistics_type_id:integer value:integer
script/generate model statistics_daily_statistics_by_agent day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_statistics week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_statistics_by_agent week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_statistics_by_agent start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_statistics start_day:date agent_id:string statistics_type_id:integer value:integer

script/generate model statistics_daily_keyword day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_daily_keyword_by_agent day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_daily_voice_log day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_daily_voice_log_by_agent day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_keyword week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_keyword_by_agent week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_voice_log week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_weekly_voice_log_by_agent week:integer start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_voice_log_by_agent start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_keyword start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_keyword_by_agent start_day:date agent_id:string statistics_type_id:integer value:integer
script/generate model statistics_monthly_voice_log start_day:date agent_id:string statistics_type_id:integer value:integer

SELECT count("daily_statistics".id) AS count_id, agent_id AS agent_id FROM "daily_statistics" WHERE (start_date in '2009-01-11','2009-01-12','2009-01-13','2009-01-14','2009-01-15','2009-01-16','2009-01-17')  GROUP BY agent_id  (ActiveRecord::StatementInvalid)


#
# 通話検索について
# エージェント名、エージェントIDでの検索について比較したい
# CTI
#


#
# CTIや画面から取得した情報を保存して通話に紐付ける
# 通話開始時刻からの時間をいれておく。CTIサーバなどと時刻がずれていても表示しやすいように。
# メモは範囲型とピンポイント型を指定できるようにする
#   範囲型 ... start_secとend_secを指定
#   ピンポイント型 ... end_sec をnullに指定
# 範囲型は通話の範囲を、ピンポイント型はある時点に対してコメントを入れる
# メモや、通話情報、キーワードからURLを作成できるようにし、そのポイントから音声の再生などができるようにする
# これは外部アプリケーションとの連系の一番簡易的な方法として提供する。
# 例１）http://server/voice_logs/908f98zx98cver14/?play=t
#   →  voice_log_id = 908f98zx98cver14 の通話を表示して音声再生する
# 例２）http://server/voice_logs/908f98zx98cver14/1333_1510?play=t
#   →  voice_log_id = 908f98zx98cver14 の通話の13.33秒目から15.10秒目を表示して音声再生する
script/generate model call_information voice_log_id:integer start_sec:integer end_sec:integer event:string this_dn:string other_dn:string
script/generate model call_bookmark voice_log_id:integer start_sec:integer end_time:integer title:string description:string

#
voice_logs ngword_counter:integer mustword_count:integer ngword_count:integer bookmark_count:integer

