TODO
* 正規分布にしたがって適当なテストデータを作る
* create_testdat_* をrakeに直す => done
* keywordをNGとMUSTにわける
* voice_logsで先読みがうまくいかない
SQLite3::SQLException: ambiguous column name: id:
SELECT DISTINCT "voice_logs".id FROM "voice_logs"
  LEFT OUTER JOIN "result_keywords" ON result_keywords.voice_log_id = voice_logs.id
  LEFT OUTER JOIN "call_bookmarks" ON call_bookmarks.voice_log_id = voice_logs.id
  LEFT OUTER JOIN "users" ON "users".id = "voice_logs".agent_id
WHERE (voice_logs.id = result_keywords.voice_log_id AND
       voice_logs.id = call_bookmarks.voice_log_id AND
       voice_logs.agent_id = users.id)
ORDER BY id LIMIT 26 OFFSET 52


2009/1/19
* データベースをMySQLに変更
  あらかじめ、schemaを作成しておかないと rake db:migrate に失敗する。
  MySQL Administratorでschemaを作成する。

2009/1/20
* キーワード統計と編集画面がとりあえず完成
  -> 日次、週次の表示が非常に遅い。横持にしたデータも作っておく

2009/1/25
* voice_logsテストデータを変更
* テストデータにパスワードを埋め込む
* log/development.log が11GBになっていた。本番環境では注意すること。



プラグインまとめ
 * calendar_helper
 * act_as_taggable
 * engines
 * datebox_engine

ページ送り
 * will_paginate

ユーザログイン
 1. login_generator(簡単なユーザー認証機能を組み込む)
 2. Ruby-Get-Text-Package(Rubyアプリを多言語化する)

* Annotate Models
script/plugin install http://repo.pragprog.com/svn/Public/plugins/annotate_models


lib/tasks/以下に*.rakeファイルのバックアップをとると同名のタスクが２つ定義されることになり
おかしな挙動をするので、rakeファイルのバックアップは他の場所にとること

モデルの集計関数が複数個の検索条件でgroup byできない
必ずひとつだけになる。なぜ？？

データベースの先読み
KeywordContoroller参照
データベースを先読みするには、先読みするデータベースをincludeで指定したうえでconditionsに
関連テーブル.カラム名を使って条件指定する。joinでは先読みしてくれないので注意する。
先読みされたかどうかは、mongorelなどのコンソールを見ていればわかる。
先読みの場合
Processing KeywordsController#index (for 127.0.0.1 at 2009-01-18 16:00:58) [GET]
  StatisticsType Load (0.9ms)   SELECT * FROM "statistics_types" WHERE ('ResultKeyword'=target_model and 'f'=by_agent and 'sum'=value_type) LIMIT 1
  Keyword Load Including Associations (229.4ms)
SELECT "keywords"."id" AS t0_r0,
       "keywords"."name" AS t0_r1,
       "keywords"."match_string" AS t0_r2,
       "keywords"."keyword_type" AS t0_r3,
       "keywords"."created_at" AS t0_r4,
       "keywords"."updated_at" AS t0_r5,
       "monthly_statistics"."id" AS t1_r0,
       "monthly_statistics"."start_day" AS t1_r1,
       "monthly_statistics"."agent_id" AS t1_r2,
       "monthly_statistics"."keyword_id" AS t1_r3,
       "monthly_statistics"."statistics_type_id" AS t1_r4,
       "monthly_statistics"."value" AS t1_r5,
       "monthly_statistics"."created_at" AS t1_r6,
       "monthly_statistics"."updated_at" AS t1_r7
FROM "keywords" LEFT OUTER JOIN "monthly_statistics" ON monthly_statistics.keyword_id = keywords.id
WHERE (statistics_type_id = 18 and start_day between '2008-07-18' and '2009-02-18' and monthly_statistics.keyword_id = keywords.id)
ORDER BY start_day,value desc
Rendering keywords/index
Completed in 390ms (View: 71, DB: 230) | 200 OK [http://localhost/keywords]

先読みされていない場合
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 138)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 160)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 95)

　　略

  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 133)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 165)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 96)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 114)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 150)
  CACHE (0.0ms)   SELECT * FROM "monthly_statistics" WHERE ("monthly_statistics".keyword_id = 129)
Completed in 1213ms (View: 827, DB: 294) | 200 OK [http://localhost/keywords]


グループツリーコントロールとの連携
 1.アイテムを選択してもツリーの開閉をしないようにする
 2.アイテムを選択したら、選択された項目で表示内容を変える
　　dash_board, statistics
 3.アイテムを選択して、検索ボタンを押すと選択内容をサーバに送信する
　　voice_logs




 * Extjsの拡張
■サンプル
　http://extjs.com/deploy/dev/examples/tree/column-tree.html
■リスト表示
[{
    task:'ColumnTree Example',
    duration:'3 hours',
    user:'',
    uiProvider:'col',
    cls:'master-task',
    iconCls:'task-folder',
    children:[{
        task:'Abstract rendering in TreeNodeUI',
        duration:'15 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreeNodeUI with column knowledge',
        duration:'45 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreePanel to render and lock headers',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Add CSS to make it look fly',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Test and make sure it works',
        duration:'1 hour',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    }]
},{
    task:'Custom Field Example',
    duration:'2 1/2 hours',
    user:'',
    uiProvider:'col',
    cls:'master-task',
    iconCls:'task-folder',
    children:[{
        task:'Implement "Live Search" on extjs.com from Alex',
        duration:'1 hour',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Extend TwinTrigger',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Testing and debugging',
        duration:'1 hour',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    }]
},{
    task:'Foo Bar Item',
    duration:'3 hours',
    user:'',
    uiProvider:'col',
    cls:'master-task',
    iconCls:'task-folder',
    children:[{
        task:'Abstract rendering in TreeNodeUI',
        duration:'15 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreeNodeUI with column knowledge',
        duration:'45 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreePanel to render and lock headers',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Add CSS to make it look fly',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Test and make sure it works',
        duration:'1 hour',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    }]
},{
    task:'WTF Item',
    duration:'3 hours',
    user:'',
    uiProvider:'col',
    cls:'master-task',
    iconCls:'task-folder',
    children:[{
        task:'Abstract rendering in TreeNodeUI',
        duration:'15 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreeNodeUI with column knowledge',
        duration:'45 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Create TreePanel to render and lock headers',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Add CSS to make it look fly',
        duration:'30 min',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    },{
        task:'Test and make sure it works',
        duration:'1 hour',
        user:'Jack Slocum',
        uiProvider:'col',
        leaf:true,
        iconCls:'task'
    }]
}]
